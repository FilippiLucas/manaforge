<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Deck - ManaForge</title>
    <link href="./styles/tailwind.css" rel="stylesheet">
</head>

<body class="bg-gray-900 text-gray-100">
    <nav class="bg-gray-800">
        <div class="max-w-6xl mx-auto px-4 h-[70px] flex items-center">
            <a href="decks.html" class="text-gray-200 hover:text-white font-semibold">← Back to Decks</a>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto mt-6 p-4">
        <header class="mb-6">
            <h1 id="deck-title" class="text-2xl font-bold">Deck</h1>
        </header>

        <section>
            <ul id="card-list" class="space-y-2">

                <li class="group relative bg-gray-800 rounded p-3 flex items-center justify-between"
                    data-img="https://res.cloudinary.com/dqnrpauzk/image/upload/v1763919969/Niv_bygnih.jpg">
                    <span class="text-sm preview-trigger">Niv-Mizzet, Supreme</span>
                    <div class="flex items-center gap-2">
                        <button class="remove-btn px-2 py-1 text-xs bg-red-600 rounded hover:bg-red-500">Remove</button>
                    </div>
                </li>

                <li class="group relative bg-gray-800 rounded p-3 flex items-center justify-between"
                    data-img="https://res.cloudinary.com/dqnrpauzk/image/upload/v1763919969/Nicol_zwdpbu.jpg">
                    <span class="text-sm preview-trigger">Nicol Bolas</span>
                    <div class="flex items-center gap-2">
                        <button class="remove-btn px-2 py-1 text-xs bg-red-600 rounded hover:bg-red-500">Remove</button>
                    </div>
                </li>

            </ul>
        </section>
    </main>

    <!-- Centered preview modal (used for hover-preview and mobile tap) -->
    <div id="card-preview" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/70 p-4">
        <div class="relative max-w-[90vw] max-h-[90vh] w-full flex items-center justify-center">
            <img id="card-preview-img" src="" alt="card preview"
                class="max-w-full max-h-[80vh] object-contain rounded shadow-lg" />
            <button id="card-preview-close"
                class="absolute top-2 right-2 bg-black/50 text-white rounded px-2 py-1">✕</button>
        </div>
    </div>

    <script>
        (function () {
            // set deck title from querystring
            const params = new URLSearchParams(location.search);
            const name = params.get('name') || 'Untitled Deck';
            document.getElementById('deck-title').textContent = decodeURIComponent(name);

            const previewOverlay = document.getElementById('card-preview');
            const previewImg = document.getElementById('card-preview-img');
            const previewClose = document.getElementById('card-preview-close');

            function showPreview(src) {
                if (!src) return;
                previewImg.src = src;
                previewOverlay.classList.remove('hidden');
            }

            function hidePreview(force = false) {
                previewImg.src = '';
                previewOverlay.classList.add('hidden');
            }

            // close handlers
            previewOverlay.addEventListener('click', (e) => {
                if (e.target === previewOverlay || e.target === previewClose) {
                    hidePreview(true);
                }
            });
            previewClose.addEventListener('click', () => hidePreview(true));
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') hidePreview(true);
            });

            // remove button behavior
            document.getElementById('card-list').addEventListener('click', (e) => {
                const btn = e.target.closest('.remove-btn');
                if (btn) {
                    const li = btn.closest('li');
                    if (!li) return;
                    e.stopPropagation();
                    if (!confirm('Remove this card from the deck?')) return;
                    li.remove();
                    return;
                }
            });

            // Click-to-preview (desktop + mobile). Toggle when clicking same name; swap when clicking a different name.
            document.querySelectorAll('#card-list > li').forEach(li => {
                const src = li.getAttribute('data-img');
                const trigger = li.querySelector('.preview-trigger');

                if (trigger) {
                    trigger.addEventListener('click', (e) => {
                        e.stopPropagation();
                        // if preview is open and showing the same src, close it (toggle)
                        const currentlyOpen = !previewOverlay.classList.contains('hidden');
                        const sameImage = currentlyOpen && previewImg.src && previewImg.src.includes(src);
                        if (sameImage) {
                            hidePreview(true);
                        } else {
                            showPreview(src);
                        }
                    });
                }

                // prevent other li clicks from opening preview and ignore remove-btn clicks
                li.addEventListener('click', (e) => {
                    if (e.target.closest('.remove-btn')) return;
                });
            });

            // clicking outside list hides preview
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#card-list') && !e.target.closest('#card-preview')) {
                    hidePreview(true);
                }
            });

        })();
    </script>
</body>

</html>